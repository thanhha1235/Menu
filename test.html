<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Chuẩn hóa báo cáo suất ăn</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 20px;
}
textarea {
    width: 100%;
    height: 160px;
    padding: 10px;
    font-size: 14px;
}
button {
    margin-top: 10px;
    padding: 10px 18px;
    font-size: 14px;
    cursor: pointer;
}
pre {
    background: #fff;
    padding: 12px;
    border-left: 4px solid #4CAF50;
    white-space: pre-wrap;
    margin-top: 10px;
}
</style>
</head>
<body>

<h3>Dán báo cáo suất ăn</h3>
<textarea id="input" placeholder="Dán báo cáo vào đây..."></textarea>
<br>
<button onclick="standardize()">Chuẩn hóa</button>

<h3>Kết quả</h3>
<pre id="output"></pre>

<script>
function standardize() {
    let text = document.getElementById("input").value;
    if (!text.trim()) {
        alert("Chưa có nội dung");
        return;
    }

    // ======================
    // 1. Làm sạch text
    // ======================
    text = text
        .replace(/,/g, " ")
        .replace(/suất/gi, "")
        .replace(/\s+/g, " ")
        .trim();

    // ======================
    // 2. Lấy tên khối / phòng ban (fallback nhiều lớp)
    // ======================
    function getPhongBan(text) {
      const patterns = [
        // 1️⃣ Có chữ Khối / Phòng ban
        /(khối|phòng\s*ban|phong\s*ban)\s*[:\-]?\s*([A-Z0-9]{2,})/i,

        // 2️⃣ Tên khối đứng trước từ "đăng / xuất / ăn"
   /\b([A-Z]{3,})\b\s*(?:đăng|dk|xuất|suất|ăn)/i,


        // 3️⃣ Fallback: chữ in hoa bất kỳ
        /\b([A-Z]{3,})\b/
    ];

        for (let p of patterns) {
            const m = text.match(p);
            if (m) return m[m.length - 1];
        }
        return "KHÔNG_XÁC_ĐỊNH";
    }

    const phongBan = getPhongBan(text);

    // ======================
    // 3. Lấy số thực đơn
    // ======================
    function getMenu(text, num) {
        const regex = new RegExp(
            `(thực\\s*đơn|thuc\\s*don|menu|td|m)\\s*${num}\\s*[:=\\-]?\\s*(\\d+)`,
            "i"
        );
        const m = text.match(regex);
        return m ? parseInt(m[2]) : 0;
    }

    const td1 = getMenu(text, 1);
    const td2 = getMenu(text, 2);
    const td3 = getMenu(text, 3);

    // ======================
    // 4. Xuất kết quả chuẩn
    // ======================
    const result =
`${phongBan}:
Thực đơn 1: ${td1}
Thực đơn 2: ${td2}
Thực đơn 3: ${td3}`;

    document.getElementById("output").textContent = result;
}
</script>

</body>
</html>
